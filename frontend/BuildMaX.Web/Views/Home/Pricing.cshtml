@model IEnumerable<BuildMaX.Web.Models.Domain.Variant>

@{
    ViewData["Title"] = "Cennik";

    var variants = (Model ?? Enumerable.Empty<BuildMaX.Web.Models.Domain.Variant>())
        .OrderBy(v => v.Price)
        .ToList();

    var maxPrice = variants.Count > 0 ? variants.Max(v => v.Price) : 0m;

    string CardBorder(BuildMaX.Web.Models.Domain.Variant v)
        => v.Price == maxPrice ? "border-primary" : "";

    string HeaderClass(BuildMaX.Web.Models.Domain.Variant v)
        => v.Price == maxPrice ? "text-bg-primary border-primary" : "";

    string ButtonClass(BuildMaX.Web.Models.Domain.Variant v)
        => v.Price == maxPrice ? "btn btn-lg btn-primary w-100" : "btn btn-lg btn-outline-primary w-100";
}

<div class="container py-4">

    <div class="pricing-header p-3 pb-md-4 mx-auto text-center">
        <h1 class="display-4 fw-normal">Cennik</h1>
        <p class="fs-5 text-body-secondary">
            Wybierz wariant dopasowany do szybkości decyzji i poziomu szczegółowości analizy.
        </p>
    </div>

    @if (variants.Count == 0)
    {
        <div class="alert alert-warning">
            Brak wariantów w bazie. Dodaj warianty jako Admin w panelu lub przez seeding.
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-3 mb-4 text-center">
            @foreach (var v in variants)
            {
                <div class="col">
                    <div class="card mb-4 rounded-3 shadow-sm @CardBorder(v)">
                        <div class="card-header py-3 @HeaderClass(v)">
                            <h4 class="my-0 fw-normal">@v.Name</h4>
                        </div>

                        <div class="card-body">
                            <h1 class="card-title pricing-card-title">
                                @v.Price.ToString("0.00") PLN
                                <small class="text-body-secondary fw-light">/ analiza</small>
                            </h1>

                            <ul class="list-unstyled mt-3 mb-4 text-start">
                                <li>@(v.IncludesPdf ? "✓" : "—") Raport PDF + dokumenty prawne</li>
                                <li>@(v.IncludesPercentDetails ? "✓" : "—") Szczegółowe dane procentowe</li>
                                <li>@(v.IncludesSitePlan ? "✓" : "—") Plan zagospodarowania</li>

                                @if (!string.IsNullOrWhiteSpace(v.Description))
                                {
                                    <li class="mt-2 text-body-secondary">@v.Description</li>
                                }
                            </ul>

                            <a class="@ButtonClass(v)" asp-controller="Account" asp-action="Register">
                                Wybierz wariant
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <h2 class="display-6 text-center mb-3">Porównanie</h2>
        <div class="table-responsive">
            <table class="table text-center align-middle">
                <thead>
                    <tr>
                        <th style="width: 34%;"></th>
                        @foreach (var v in variants)
                        {
                            <th style="width: 22%;">@v.Name</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row" class="text-start">Raport PDF</th>
                        @foreach (var v in variants)
                        {
                            <td>@(v.IncludesPdf ? "✓" : "")</td>
                        }
                    </tr>
                    <tr>
                        <th scope="row" class="text-start">Dane procentowe</th>
                        @foreach (var v in variants)
                        {
                            <td>@(v.IncludesPercentDetails ? "✓" : "")</td>
                        }
                    </tr>
                    <tr>
                        <th scope="row" class="text-start">Plan zagospodarowania</th>
                        @foreach (var v in variants)
                        {
                            <td>@(v.IncludesSitePlan ? "✓" : "")</td>
                        }
                    </tr>
                </tbody>
            </table>
        </div>
    }

</div>
